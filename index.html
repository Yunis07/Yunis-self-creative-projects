<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#000814" />
    <meta
      name="description"
      content="Ultimate Productivity Dashboard with Cloud Sync"
    />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üöÄ</text></svg>"
    />
    <title>Productivity Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #000814;
        color: #e0e0e0;
        min-height: 100vh;
        overflow-x: hidden;
      }

      .grid-bg {
        position: fixed;
        inset: 0;
        background-image: linear-gradient(
            to right,
            rgba(0, 255, 200, 0.06) 1px,
            transparent 1px
          ),
          linear-gradient(
            to bottom,
            rgba(0, 255, 200, 0.06) 1px,
            transparent 1px
          );
        background-size: 60px 60px;
        z-index: 0;
        animation: gridShift 40s linear infinite;
      }

      @keyframes gridShift {
        0% {
          background-position: 0 0;
        }
        100% {
          background-position: 60px 60px;
        }
      }

      @keyframes particleFloat {
        0% {
          transform: translateY(100vh) translateX(0) scale(0.3);
          opacity: 0;
        }
        10% {
          opacity: 0.8;
        }
        90% {
          opacity: 0.8;
        }
        100% {
          transform: translateY(-100px) translateX(50px) scale(0);
          opacity: 0;
        }
      }

      @keyframes spinGlow {
        0% {
          transform: translate(-50%, -50%) rotate(0deg);
        }
        100% {
          transform: translate(-50%, -50%) rotate(360deg);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.08);
          opacity: 0.8;
        }
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes shimmerEffect {
        0% {
          background-position: -1000px 0;
        }
        100% {
          background-position: 1000px 0;
        }
      }

      .particle {
        position: fixed;
        width: 6px;
        height: 6px;
        background: radial-gradient(circle, #00ffc8, #a855f7);
        border-radius: 50%;
        pointer-events: none;
        animation: particleFloat linear infinite;
        z-index: 1;
        box-shadow: 0 0 20px #00ffc8;
      }

      .sync-status {
        position: fixed;
        top: 1rem;
        right: 1rem;
        background: linear-gradient(
          135deg,
          rgba(0, 255, 200, 0.2),
          rgba(168, 85, 247, 0.2)
        );
        backdrop-filter: blur(10px);
        border: 1px solid #00ffc8;
        border-radius: 1rem;
        padding: 0.75rem 1.5rem;
        z-index: 10000;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
      }

      .sync-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #10b981;
        animation: pulse 2s infinite;
      }

      .sidebar {
        position: fixed;
        left: 1.5rem;
        top: 50%;
        transform: translateY(-50%);
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .nav-btn-wrapper {
        position: relative;
        width: 5rem;
        height: 5rem;
      }

      .nav-glow {
        position: absolute;
        inset: -6px;
        border-radius: 1.2rem;
        overflow: hidden;
        filter: blur(15px);
        opacity: 0;
        transition: opacity 0.5s;
        z-index: -1;
      }

      .nav-glow::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 300px;
        height: 300px;
        background: conic-gradient(
          transparent,
          #00ffc8 10%,
          transparent 30%,
          transparent 50%,
          #a855f7 70%,
          transparent 90%
        );
        animation: spinGlow 4s linear infinite;
      }

      .nav-btn {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #0a1a2e, #16213e);
        border: 2px solid #00ffc8;
        border-radius: 1.2rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        box-shadow: inset 0 0 15px rgba(0, 255, 200, 0.1);
      }

      .nav-btn-wrapper:hover .nav-glow {
        opacity: 1;
      }

      .nav-btn-wrapper:hover .nav-btn {
        transform: scale(1.15) rotate(5deg);
        box-shadow: 0 0 40px rgba(0, 255, 200, 0.7),
          inset 0 0 15px rgba(0, 255, 200, 0.2);
      }

      .nav-btn-wrapper.active .nav-glow {
        opacity: 1;
      }

      .nav-btn-wrapper.active .nav-btn {
        box-shadow: 0 0 50px rgba(0, 255, 200, 0.9),
          inset 0 0 15px rgba(0, 255, 200, 0.3);
        transform: scale(1.1);
      }

      .main-content {
        margin-left: 9rem;
        margin-right: 1.5rem;
        padding: 2rem;
        position: relative;
        z-index: 10;
      }

      .section {
        display: none;
      }

      .section.active {
        display: block;
        animation: slideIn 0.6s;
      }

      .glass-card-wrapper {
        position: relative;
        margin-bottom: 2rem;
      }

      .card-glow {
        position: absolute;
        inset: -6px;
        border-radius: 2rem;
        overflow: hidden;
        filter: blur(25px);
        opacity: 0;
        transition: opacity 0.5s;
        z-index: -1;
      }

      .card-glow::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 800px;
        height: 800px;
        background: conic-gradient(
          transparent,
          #00ffc8 5%,
          transparent 25%,
          transparent 50%,
          #a855f7 55%,
          transparent 75%
        );
        animation: spinGlow 6s linear infinite;
      }

      .glass-card-wrapper:hover .card-glow {
        opacity: 0.8;
      }

      .glass-card {
        background: linear-gradient(
          135deg,
          rgba(10, 26, 46, 0.9),
          rgba(15, 30, 55, 0.9)
        );
        backdrop-filter: blur(20px);
        border-radius: 2rem;
        padding: 2rem;
        border: 1px solid rgba(0, 255, 200, 0.2);
        position: relative;
        transition: all 0.4s;
      }

      .glass-card-wrapper:hover .glass-card {
        transform: translateY(-5px);
        border-color: rgba(0, 255, 200, 0.4);
      }

      .schedule-card {
        background: linear-gradient(135deg, #1e293b, #0f172a);
        border-radius: 1.5rem;
        padding: 1.5rem;
        border: 1px solid rgba(0, 255, 200, 0.3);
        margin-bottom: 1rem;
        position: relative;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        cursor: pointer;
      }

      .schedule-card:hover {
        transform: translateY(-10px) scale(1.03);
        border-color: #00ffc8;
        box-shadow: 0 20px 60px rgba(0, 255, 200, 0.4);
      }

      .time-badge {
        display: inline-block;
        background: linear-gradient(135deg, #00ffc8, #a855f7);
        color: #000814;
        font-size: 0.875rem;
        font-weight: bold;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        margin-bottom: 0.75rem;
        box-shadow: 0 4px 15px rgba(0, 255, 200, 0.4);
      }

      .stats-card {
        text-align: center;
        padding: 1.5rem;
        background: linear-gradient(
          135deg,
          rgba(0, 255, 200, 0.08),
          rgba(168, 85, 247, 0.08)
        );
        border-radius: 1rem;
        border: 1px solid rgba(0, 255, 200, 0.3);
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
        overflow: hidden;
      }

      .stats-card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          45deg,
          transparent 30%,
          rgba(255, 255, 255, 0.1) 50%,
          transparent 70%
        );
        background-size: 200% 200%;
        animation: shimmerEffect 3s linear infinite;
      }

      .stats-card:hover {
        transform: translateY(-10px) scale(1.08);
        box-shadow: 0 20px 60px rgba(0, 255, 200, 0.5);
      }

      .btn-primary {
        background: linear-gradient(135deg, #00ffc8, #a855f7);
        color: #000814;
        border: none;
        padding: 1rem 2rem;
        border-radius: 1rem;
        font-weight: bold;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        box-shadow: 0 10px 30px rgba(0, 255, 200, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-5px) scale(1.1);
        box-shadow: 0 15px 40px rgba(0, 255, 200, 0.6);
      }

      .btn-primary:active {
        transform: translateY(-2px) scale(1.05);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #1e293b, #0f172a);
        color: #00ffc8;
        border: 2px solid #00ffc8;
        padding: 1rem 2rem;
        border-radius: 1rem;
        font-weight: bold;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.4s;
      }

      .btn-secondary:hover {
        border-color: #a855f7;
        color: #a855f7;
        transform: translateY(-5px) scale(1.08);
        box-shadow: 0 10px 30px rgba(0, 255, 200, 0.4);
      }

      .btn-secondary:active {
        transform: translateY(-2px);
      }

      .btn-danger {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 0.75rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
      }

      .btn-danger:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 20px rgba(239, 68, 68, 0.5);
      }

      .btn-danger:active {
        transform: scale(1.05);
      }

      .habit-day {
        background: linear-gradient(135deg, #1e293b, #0f172a);
        border: 2px solid #00ffc8;
        border-radius: 1rem;
        padding: 1rem;
        cursor: pointer;
        text-align: center;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      .habit-day:hover {
        transform: scale(1.15) rotate(5deg);
        border-color: #a855f7;
        box-shadow: 0 0 20px rgba(0, 255, 200, 0.4);
      }

      .habit-day.checked {
        background: linear-gradient(135deg, #00ffc8, #a855f7);
        border-color: transparent;
        animation: pulse 0.6s;
      }

      input[type="text"],
      select,
      textarea {
        width: 100%;
        padding: 1rem;
        background: rgba(30, 41, 59, 0.5);
        border: 2px solid #00ffc8;
        border-radius: 1rem;
        color: white;
        font-size: 1rem;
        margin-bottom: 1rem;
        transition: all 0.3s;
      }

      textarea {
        resize: vertical;
        min-height: 100px;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #a855f7;
        box-shadow: 0 0 30px rgba(0, 255, 200, 0.5);
        background: rgba(30, 41, 59, 0.8);
      }

      input[type="checkbox"] {
        width: 1.5rem;
        height: 1.5rem;
        accent-color: #00ffc8;
        cursor: pointer;
      }

      .gradient-text {
        background: linear-gradient(135deg, #00ffc8, #a855f7, #ff0055);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 900;
      }

      .customization-section {
        background: linear-gradient(
          135deg,
          rgba(30, 41, 59, 0.5),
          rgba(15, 23, 42, 0.5)
        );
        border-radius: 1.5rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border: 1px solid #00ffc8;
      }

      .grid-2 {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
      }
      .grid-3 {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
      }
      .grid-4 {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
      }
      .grid-7 {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 0.75rem;
      }

      @media (max-width: 768px) {
        .main-content {
          margin-left: 5rem;
        }
        .grid-3,
        .grid-4 {
          grid-template-columns: 1fr;
        }
        .sync-status {
          top: 0.5rem;
          right: 0.5rem;
          font-size: 0.75rem;
          padding: 0.5rem 1rem;
        }
      }

      .install-prompt {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: linear-gradient(135deg, #00ffc8, #a855f7);
        color: #000814;
        padding: 1rem 2rem;
        border-radius: 1rem;
        font-weight: bold;
        cursor: pointer;
        z-index: 10000;
        box-shadow: 0 10px 40px rgba(0, 255, 200, 0.6);
        display: none;
        animation: pulse 2s infinite;
      }

      .db-mode-badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        margin-top: 1rem;
      }

      .db-mode-local {
        background: linear-gradient(
          135deg,
          rgba(239, 68, 68, 0.2),
          rgba(220, 38, 38, 0.2)
        );
        border: 1px solid #ef4444;
        color: #fca5a5;
      }

      .db-mode-cloud {
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.2),
          rgba(5, 150, 105, 0.2)
        );
        border: 1px solid #10b981;
        color: #6ee7b7;
      }
    </style>
  </head>
  <body>
    <div class="grid-bg"></div>
    <div id="particles"></div>

    <div class="sync-status">
      <div class="sync-indicator"></div>
      <span id="syncText">üíæ Local Storage</span>
    </div>

    <div id="installPrompt" class="install-prompt">üì± Install App</div>

    <div class="sidebar">
      <div class="nav-btn-wrapper active" onclick="switchSection('home', this)">
        <div class="nav-glow"></div>
        <button class="nav-btn">üè†</button>
      </div>
      <div class="nav-btn-wrapper" onclick="switchSection('study', this)">
        <div class="nav-glow"></div>
        <button class="nav-btn">üìö</button>
      </div>
      <div class="nav-btn-wrapper" onclick="switchSection('habits', this)">
        <div class="nav-glow"></div>
        <button class="nav-btn">‚úÖ</button>
      </div>
      <div class="nav-btn-wrapper" onclick="switchSection('analytics', this)">
        <div class="nav-glow"></div>
        <button class="nav-btn">üìä</button>
      </div>
      <div class="nav-btn-wrapper" onclick="switchSection('goals', this)">
        <div class="nav-glow"></div>
        <button class="nav-btn">üéØ</button>
      </div>
      <div class="nav-btn-wrapper" onclick="switchSection('tasks', this)">
        <div class="nav-glow"></div>
        <button class="nav-btn">üìù</button>
      </div>
      <div class="nav-btn-wrapper" onclick="switchSection('customize', this)">
        <div class="nav-glow"></div>
        <button class="nav-btn">‚öôÔ∏è</button>
      </div>
    </div>

    <div class="main-content">
      <!-- HOME -->
      <div id="home" class="section active">
        <div class="glass-card-wrapper">
          <div class="card-glow"></div>
          <div class="glass-card" style="text-align: center">
            <div
              id="quoteText"
              style="
                font-size: 1.5rem;
                font-style: italic;
                margin-bottom: 0.5rem;
                color: #e0e0e0;
              "
            >
              "The secret of getting ahead is getting started."
            </div>
            <div id="quoteAuthor" style="color: #00ffc8; font-weight: 600">
              ‚Äî Mark Twain
            </div>
          </div>
        </div>

        <div style="text-align: center; margin-bottom: 3rem">
          <div
            id="currentTime"
            class="gradient-text"
            style="font-size: 4rem; margin-bottom: 1rem"
          ></div>
          <div
            id="currentDate"
            style="font-size: 1.125rem; color: #94a3b8; margin-bottom: 2rem"
          ></div>

          <div class="grid-4" style="max-width: 900px; margin: 0 auto 2rem">
            <div class="stats-card">
              <div
                id="taskCount"
                style="
                  font-size: 2.5rem;
                  font-weight: 900;
                  color: #00ffc8;
                  position: relative;
                  z-index: 1;
                "
              >
                0
              </div>
              <div
                style="
                  font-size: 0.75rem;
                  color: #64748b;
                  text-transform: uppercase;
                  position: relative;
                  z-index: 1;
                "
              >
                TASKS
              </div>
            </div>
            <div class="stats-card">
              <div
                id="doneCount"
                style="
                  font-size: 2.5rem;
                  font-weight: 900;
                  color: #a855f7;
                  position: relative;
                  z-index: 1;
                "
              >
                0
              </div>
              <div
                style="
                  font-size: 0.75rem;
                  color: #64748b;
                  text-transform: uppercase;
                  position: relative;
                  z-index: 1;
                "
              >
                DONE
              </div>
            </div>
            <div class="stats-card">
              <div
                id="habitCount"
                style="
                  font-size: 2.5rem;
                  font-weight: 900;
                  color: #ff0055;
                  position: relative;
                  z-index: 1;
                "
              >
                0
              </div>
              <div
                style="
                  font-size: 0.75rem;
                  color: #64748b;
                  text-transform: uppercase;
                  position: relative;
                  z-index: 1;
                "
              >
                HABITS
              </div>
            </div>
            <div class="stats-card">
              <div
                id="progressPercent"
                style="
                  font-size: 2.5rem;
                  font-weight: 900;
                  color: #10b981;
                  position: relative;
                  z-index: 1;
                "
              >
                0%
              </div>
              <div
                style="
                  font-size: 0.75rem;
                  color: #64748b;
                  text-transform: uppercase;
                  position: relative;
                  z-index: 1;
                "
              >
                PROGRESS
              </div>
            </div>
          </div>

          <div
            id="targetDisplay"
            style="
              display: inline-block;
              background: linear-gradient(135deg, #00ffc8, #a855f7);
              color: #000814;
              padding: 1rem 2.5rem;
              border-radius: 9999px;
              font-weight: bold;
              font-size: 1.25rem;
              box-shadow: 0 10px 40px rgba(0, 255, 200, 0.5);
            "
          >
            üéØ Target: 8.5+ CGPA
          </div>
        </div>

        <h3
          class="gradient-text"
          style="font-size: 2.5rem; text-align: center; margin-bottom: 2rem"
        >
          TODAY'S SCHEDULE
        </h3>
        <div id="scheduleContainer" class="grid-3"></div>
      </div>

      <!-- STUDY -->
      <div id="study" class="section">
        <h2
          class="gradient-text"
          style="font-size: 3rem; text-align: center; margin-bottom: 3rem"
        >
          STUDY SESSION
        </h2>

        <div class="glass-card-wrapper">
          <div class="card-glow"></div>
          <div class="glass-card" style="text-align: center">
            <div
              id="pomodoroDisplay"
              style="
                font-size: 6rem;
                font-weight: 900;
                background: linear-gradient(135deg, #00ffc8, #a855f7);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin: 2rem 0;
              "
            >
              25:00
            </div>

            <div
              style="
                display: flex;
                gap: 1rem;
                justify-content: center;
                margin-bottom: 2rem;
                flex-wrap: wrap;
              "
            >
              <button class="btn-primary" onclick="setWork()">
                ‚è±Ô∏è Work (25m)
              </button>
              <button class="btn-secondary" onclick="setBreak()">
                ‚òï Break (5m)
              </button>
            </div>

            <div
              style="
                display: flex;
                gap: 1rem;
                justify-content: center;
                margin-bottom: 2rem;
                flex-wrap: wrap;
              "
            >
              <button
                id="startBtn"
                class="btn-primary"
                onclick="togglePomodoro()"
              >
                ‚ñ∂Ô∏è Start
              </button>
              <button class="btn-secondary" onclick="resetPomodoro()">
                ‚Üª Reset
              </button>
            </div>

            <div style="margin-top: 2rem">
              <label
                style="
                  color: #00ffc8;
                  font-weight: 600;
                  display: block;
                  margin-bottom: 0.5rem;
                "
                >üîî Custom Alarm (optional):</label
              >
              <input
                type="file"
                accept="audio/*"
                id="customAlarm"
                style="
                  background: rgba(30, 41, 59, 0.5);
                  border: 2px solid #00ffc8;
                  padding: 0.75rem;
                  border-radius: 0.75rem;
                "
              />
              <p
                id="alarmStatus"
                style="color: #10b981; margin-top: 0.5rem; display: none"
              >
                ‚úì Custom alarm loaded!
              </p>
            </div>
          </div>
        </div>

        <div class="glass-card-wrapper">
          <div class="card-glow"></div>
          <div class="glass-card">
            <h3 style="font-size: 1.5rem; color: #00ffc8; margin-bottom: 1rem">
              üìã Active Tasks
            </h3>
            <div id="activeTasks"></div>
          </div>
        </div>
      </div>

      <!-- HABITS -->
      <div id="habits" class="section">
        <h2
          class="gradient-text"
          style="font-size: 3rem; margin-bottom: 3rem; text-align: center"
        >
          HABIT TRACKER
        </h2>
        <div id="habitsContainer"></div>
        <div style="text-align: center; margin-top: 2rem">
          <input
            type="text"
            id="newHabitInput"
            placeholder="‚ú® Add new habit..."
            style="display: inline-block; width: 350px; margin-right: 1rem"
          />
          <button class="btn-primary" onclick="addHabit()">‚ûï Add Habit</button>
        </div>
      </div>

      <!-- ANALYTICS -->
      <div id="analytics" class="section">
        <h2
          class="gradient-text"
          style="font-size: 3rem; margin-bottom: 3rem; text-align: center"
        >
          PROGRESS ANALYTICS
        </h2>

        <div class="glass-card-wrapper">
          <div class="card-glow"></div>
          <div class="glass-card">
            <h3
              style="font-size: 1.5rem; color: #00ffc8; margin-bottom: 1.5rem"
            >
              üìà Task Completion Rate
            </h3>
            <div style="text-align: center; margin-bottom: 2rem">
              <div
                id="completionRate"
                class="gradient-text"
                style="font-size: 5rem"
              >
                0%
              </div>
              <p style="color: #94a3b8; font-size: 1.125rem">
                Overall completion rate
              </p>
            </div>

            <div class="grid-2">
              <div class="stats-card">
                <div
                  id="pendingTasks"
                  style="
                    font-size: 2.5rem;
                    font-weight: 900;
                    color: #00ffc8;
                    position: relative;
                    z-index: 1;
                  "
                >
                  0
                </div>
                <div style="color: #94a3b8; position: relative; z-index: 1">
                  Pending
                </div>
              </div>
              <div class="stats-card">
                <div
                  id="completedTasks"
                  style="
                    font-size: 2.5rem;
                    font-weight: 900;
                    color: #a855f7;
                    position: relative;
                    z-index: 1;
                  "
                >
                  0
                </div>
                <div style="color: #94a3b8; position: relative; z-index: 1">
                  Completed
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="glass-card-wrapper">
          <div class="card-glow"></div>
          <div class="glass-card">
            <h3
              style="font-size: 1.5rem; color: #00ffc8; margin-bottom: 1.5rem"
            >
              üî• Habit Streaks
            </h3>
            <div id="habitStreaks"></div>
          </div>
        </div>
      </div>

      <!-- GOALS -->
      <div id="goals" class="section">
        <h2
          class="gradient-text"
          style="font-size: 3rem; margin-bottom: 3rem; text-align: center"
        >
          YOUR GOALS
        </h2>

        <div class="glass-card-wrapper">
          <div class="card-glow"></div>
          <div class="glass-card">
            <h3
              id="goalTitle"
              style="font-size: 2rem; color: white; margin-bottom: 1.5rem"
            >
              üéØ 8.5+ CGPA
            </h3>
            <div style="text-align: center; margin: 2rem 0">
              <div
                id="cgpaProgress"
                class="gradient-text"
                style="font-size: 4rem"
              >
                0%
              </div>
              <p style="color: #94a3b8; font-size: 1.125rem">
                Based on task completion
              </p>
            </div>
            <div
              style="
                height: 1.5rem;
                background: linear-gradient(135deg, #1e293b, #0f172a);
                border-radius: 9999px;
                overflow: hidden;
                border: 1px solid #00ffc8;
              "
            >
              <div
                id="cgpaBar"
                style="
                  height: 100%;
                  background: linear-gradient(90deg, #00ffc8, #a855f7);
                  width: 0%;
                  transition: width 0.5s;
                  box-shadow: 0 0 20px rgba(0, 255, 200, 0.5);
                "
              ></div>
            </div>
          </div>
        </div>
      </div>

      <!-- TASKS -->
      <div id="tasks" class="section">
        <h2
          class="gradient-text"
          style="font-size: 3rem; margin-bottom: 3rem; text-align: center"
        >
          TASK MANAGER
        </h2>

        <div class="glass-card-wrapper">
          <div class="card-glow"></div>
          <div class="glass-card">
            <h3 style="font-size: 1.5rem; color: #00ffc8; margin-bottom: 1rem">
              ‚ûï Add New Task
            </h3>
            <input
              type="text"
              id="newTaskInput"
              placeholder="üìù Enter task name..."
            />
            <button class="btn-primary" style="width: 100%" onclick="addTask()">
              ‚ûï Add Task
            </button>
          </div>
        </div>

        <div class="glass-card-wrapper">
          <div class="card-glow"></div>
          <div class="glass-card">
            <h3
              style="font-size: 1.5rem; color: #00ffc8; margin-bottom: 1.5rem"
            >
              üìã All Tasks
            </h3>
            <div id="allTasks"></div>
          </div>
        </div>
      </div>

      <!-- CUSTOMIZE -->
      <div id="customize" class="section">
        <h2
          class="gradient-text"
          style="font-size: 3rem; margin-bottom: 3rem; text-align: center"
        >
          ‚öôÔ∏è CUSTOMIZE DASHBOARD
        </h2>

        <div class="customization-section">
          <h3 style="font-size: 1.75rem; color: #00ffc8; margin-bottom: 1.5rem">
            üíæ Storage Mode
          </h3>
          <div id="dbModeBadge" class="db-mode-badge db-mode-local">
            üì± Local Storage Mode - Data saved on this device only
          </div>
          <p style="color: #94a3b8; margin-top: 1rem; line-height: 1.6">
            Currently using browser storage. Your data is saved locally and
            works offline. To enable cloud sync across devices, set up Firebase
            below.
          </p>
        </div>

        <div class="customization-section">
          <h3 style="font-size: 1.75rem; color: #00ffc8; margin-bottom: 1.5rem">
            üéØ Target/Goal Customization
          </h3>
          <p style="color: #94a3b8; margin-bottom: 1rem">
            This will appear on Home dashboard and Goals section
          </p>
          <input
            type="text"
            id="customTarget"
            placeholder="Enter your target (e.g., 9.0+ CGPA, 100kg Deadlift, etc.)"
            value="8.5+ CGPA"
          />
          <button class="btn-primary" onclick="updateTarget()">
            üíæ Save Target
          </button>
        </div>

        <div class="customization-section">
          <h3 style="font-size: 1.75rem; color: #00ffc8; margin-bottom: 1.5rem">
            üìÖ Today's Schedule Customization
          </h3>
          <p style="color: #94a3b8; margin-bottom: 1rem">
            Manage your daily schedule items (appears on Home dashboard)
          </p>

          <div id="scheduleEditor"></div>

          <div
            style="
              border-top: 1px solid #00ffc8;
              padding-top: 1.5rem;
              margin-top: 1.5rem;
            "
          >
            <h4 style="color: #a855f7; margin-bottom: 1rem">
              ‚ûï Add New Schedule Item
            </h4>
            <input
              type="text"
              id="newScheduleTime"
              placeholder="‚è∞ Time (e.g., 9:00 AM or 2:30 PM)"
            />
            <input
              type="text"
              id="newScheduleTask"
              placeholder="‚úèÔ∏è Task/Activity"
            />
            <input
              type="text"
              id="newScheduleMethod"
              placeholder="üé® Method/Tag"
            />
            <button class="btn-primary" onclick="addScheduleItem()">
              ‚ûï Add to Schedule
            </button>
          </div>
        </div>

        <div class="customization-section">
          <h3 style="font-size: 1.75rem; color: #00ffc8; margin-bottom: 1.5rem">
            ‚ö° Quick Actions
          </h3>
          <div class="grid-2">
            <button class="btn-secondary" onclick="resetToDefaults()">
              üîÑ Reset to Defaults
            </button>
            <button class="btn-primary" onclick="exportData()">
              üì§ Export Data
            </button>
          </div>
        </div>

        <div class="customization-section">
          <h3 style="font-size: 1.75rem; color: #00ffc8; margin-bottom: 1.5rem">
            ‚òÅÔ∏è Cloud Sync Setup (Optional)
          </h3>
          <p style="color: #94a3b8; margin-bottom: 1rem">
            Enable Firebase to sync your data across all devices
          </p>

          <label
            style="
              color: #e0e0e0;
              display: block;
              margin-top: 1rem;
              margin-bottom: 0.5rem;
            "
            >Firebase API Key:</label
          >
          <input
            type="text"
            id="firebaseApiKey"
            placeholder="Enter your Firebase API Key"
          />

          <label
            style="
              color: #e0e0e0;
              display: block;
              margin-top: 1rem;
              margin-bottom: 0.5rem;
            "
            >Project ID:</label
          >
          <input
            type="text"
            id="firebaseProjectId"
            placeholder="Enter your Firebase Project ID"
          />

          <label
            style="
              color: #e0e0e0;
              display: block;
              margin-top: 1rem;
              margin-bottom: 0.5rem;
            "
            >App ID:</label
          >
          <input
            type="text"
            id="firebaseAppId"
            placeholder="Enter your Firebase App ID"
          />

          <button class="btn-primary" onclick="saveFirebaseConfig()">
            üíæ Save & Connect
          </button>
          <button
            class="btn-secondary"
            onclick="testConnection()"
            style="margin-left: 1rem"
          >
            üîç Test Connection
          </button>

          <div
            id="connectionStatus"
            style="
              margin-top: 1rem;
              padding: 1rem;
              border-radius: 0.75rem;
              display: none;
            "
          ></div>

          <details style="margin-top: 2rem; color: #94a3b8">
            <summary
              style="
                cursor: pointer;
                color: #00ffc8;
                font-weight: 600;
                margin-bottom: 1rem;
              "
            >
              üìñ How to get Firebase credentials (Click to expand)
            </summary>
            <ol style="padding-left: 1.5rem; line-height: 1.8">
              <li>
                Go to
                <a
                  href="https://console.firebase.google.com/"
                  target="_blank"
                  style="color: #a855f7"
                  >Firebase Console</a
                >
              </li>
              <li>Click "Add Project" or select existing project</li>
              <li>Click the gear icon ‚öôÔ∏è > "Project settings"</li>
              <li>Scroll to "Your apps" section</li>
              <li>Click "Web" icon (&lt;/&gt;) to add a web app</li>
              <li>Register your app and copy the config values</li>
              <li>Go to "Build" > "Firestore Database" > "Create database"</li>
              <li>Choose "Start in test mode" for easy setup</li>
              <li>Paste the credentials above and click "Save & Connect"</li>
            </ol>
          </details>
        </div>
      </div>
    </div>

    <script>
      // ==================== STORAGE LAYER (Auto-detects Firebase or localStorage) ====================
      let db = null;
      let firebaseInitialized = false;
      let firestoreLib = null;

      // Local Storage fallback functions
      const localStorageDB = {
        async save(key, data) {
          try {
            localStorage.setItem(`prod_${key}`, JSON.stringify(data));
            return true;
          } catch (e) {
            console.error("LocalStorage save error:", e);
            return false;
          }
        },
        async load(key) {
          try {
            const data = localStorage.getItem(`prod_${key}`);
            return data ? JSON.parse(data) : null;
          } catch (e) {
            console.error("LocalStorage load error:", e);
            return null;
          }
        },
      };

      async function initFirebase() {
        const config = getFirebaseConfig();
        if (!config.apiKey) {
          updateSyncStatus("üíæ Local Storage", false);
          updateDbModeBadge(false);
          return false;
        }

        try {
          const firebaseApp = await import(
            "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"
          );
          const firestore = await import(
            "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
          );

          const app = firebaseApp.initializeApp(config);
          db = firestore.getFirestore(app);
          firestoreLib = firestore;
          firebaseInitialized = true;

          updateSyncStatus("‚òÅÔ∏è Cloud Synced", true);
          updateDbModeBadge(true);
          await loadFromDatabase();
          setupRealtimeSync();
          return true;
        } catch (error) {
          console.error("Firebase init error:", error);
          updateSyncStatus("‚ùå Connection Failed", false);
          updateDbModeBadge(false);
          return false;
        }
      }

      function getFirebaseConfig() {
        return {
          apiKey: localStorage.getItem("firebase_apiKey") || "",
          authDomain: `${
            localStorage.getItem("firebase_projectId") || "demo"
          }.firebaseapp.com`,
          projectId: localStorage.getItem("firebase_projectId") || "",
          storageBucket: `${
            localStorage.getItem("firebase_projectId") || "demo"
          }.appspot.com`,
          messagingSenderId: "123456789",
          appId: localStorage.getItem("firebase_appId") || "",
        };
      }

      function updateDbModeBadge(isCloud) {
        const badge = document.getElementById("dbModeBadge");
        if (!badge) return;

        if (isCloud) {
          badge.className = "db-mode-badge db-mode-cloud";
          badge.textContent =
            "‚òÅÔ∏è Cloud Sync Mode - Data synced across all devices";
        } else {
          badge.className = "db-mode-badge db-mode-local";
          badge.textContent =
            "üì± Local Storage Mode - Data saved on this device only";
        }
      }

      window.saveFirebaseConfig = async function () {
        const apiKey = document.getElementById("firebaseApiKey").value.trim();
        const projectId = document
          .getElementById("firebaseProjectId")
          .value.trim();
        const appId = document.getElementById("firebaseAppId").value.trim();

        if (!apiKey || !projectId || !appId) {
          alert("‚ùå Please fill in all Firebase credentials");
          return;
        }

        localStorage.setItem("firebase_apiKey", apiKey);
        localStorage.setItem("firebase_projectId", projectId);
        localStorage.setItem("firebase_appId", appId);

        const success = await initFirebase();
        if (success) {
          alert(
            "‚úÖ Firebase connected successfully! Your data will now sync across devices."
          );
        } else {
          alert(
            "‚ùå Connection failed. Please check your credentials and try again."
          );
        }
      };

      window.testConnection = async function () {
        const status = document.getElementById("connectionStatus");
        status.style.display = "block";
        status.style.background = "rgba(168, 85, 247, 0.2)";
        status.style.border = "1px solid #a855f7";
        status.style.color = "#e0e0e0";
        status.textContent = "üîÑ Testing connection...";

        const success = await initFirebase();

        if (success) {
          status.style.background = "rgba(16, 185, 129, 0.2)";
          status.style.border = "1px solid #10b981";
          status.textContent = "‚úÖ Connection successful! Database is ready.";
        } else {
          status.style.background = "rgba(239, 68, 68, 0.2)";
          status.style.border = "1px solid #ef4444";
          status.textContent =
            "‚ùå Connection failed. Check credentials and try again.";
        }
      };

      function updateSyncStatus(text, isConnected) {
        const syncText = document.getElementById("syncText");
        const indicator = document.querySelector(".sync-indicator");
        if (syncText) syncText.textContent = text;
        if (indicator) {
          indicator.style.background = isConnected ? "#10b981" : "#94a3b8";
        }
      }

      async function saveToDatabase(key, data) {
        if (firebaseInitialized && db && firestoreLib) {
          try {
            await firestoreLib.setDoc(
              firestoreLib.doc(
                firestoreLib.collection(db, "productivity"),
                key
              ),
              {
                data,
                updatedAt: new Date().toISOString(),
              }
            );
            return true;
          } catch (error) {
            console.error("Firebase save error:", error);
            return await localStorageDB.save(key, data);
          }
        } else {
          return await localStorageDB.save(key, data);
        }
      }

      async function loadFromDatabase() {
        const keys = ["tasks", "habits", "habitChecks", "schedule", "target"];

        if (firebaseInitialized && db && firestoreLib) {
          try {
            for (const key of keys) {
              const docSnap = await firestoreLib.getDoc(
                firestoreLib.doc(
                  firestoreLib.collection(db, "productivity"),
                  key
                )
              );
              if (docSnap.exists()) {
                const data = docSnap.data().data;
                assignStateData(key, data);
              }
            }
          } catch (error) {
            console.error("Firebase load error:", error);
            await loadFromLocalStorage();
          }
        } else {
          await loadFromLocalStorage();
        }

        renderAll();
        updateStats();
      }

      async function loadFromLocalStorage() {
        const keys = ["tasks", "habits", "habitChecks", "schedule", "target"];
        for (const key of keys) {
          const data = await localStorageDB.load(key);
          if (data) assignStateData(key, data);
        }
      }

      function assignStateData(key, data) {
        if (key === "tasks") state.tasks = data;
        else if (key === "habits") state.habits = data;
        else if (key === "habitChecks") state.habitChecks = data;
        else if (key === "schedule") state.schedule = data;
        else if (key === "target") state.target = data;
      }

      function setupRealtimeSync() {
        if (!firebaseInitialized || !db || !firestoreLib) return;

        ["tasks", "habits", "habitChecks", "schedule", "target"].forEach(
          (key) => {
            firestoreLib.onSnapshot(
              firestoreLib.doc(
                firestoreLib.collection(db, "productivity"),
                key
              ),
              (docSnap) => {
                if (docSnap.exists()) {
                  const data = docSnap.data().data;
                  assignStateData(key, data);
                  renderAll();
                  updateStats();
                }
              }
            );
          }
        );
      }

      // ==================== PARTICLE SYSTEM ====================
      function initParticles() {
        const container = document.getElementById("particles");
        for (let i = 0; i < 40; i++) {
          const p = document.createElement("div");
          p.className = "particle";
          p.style.left = Math.random() * 100 + "%";
          p.style.animationDelay = Math.random() * 5 + "s";
          p.style.animationDuration = 15 + Math.random() * 10 + "s";
          container.appendChild(p);
        }
      }
      initParticles();

      // ==================== PWA INSTALL ====================
      let deferredPrompt;
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById("installPrompt").style.display = "block";
      });

      document
        .getElementById("installPrompt")
        .addEventListener("click", async () => {
          if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === "accepted") {
              document.getElementById("installPrompt").style.display = "none";
            }
            deferredPrompt = null;
          }
        });

      // ==================== SERVICE WORKER ====================
      if ("serviceWorker" in navigator) {
        const swCode = `
                self.addEventListener('install', e => self.skipWaiting());
                self.addEventListener('activate', e => e.waitUntil(clients.claim()));
                self.addEventListener('fetch', e => {
                    e.respondWith(
                        caches.match(e.request).then(response => response || fetch(e.request))
                    );
                });
            `;
        const blob = new Blob([swCode], { type: "application/javascript" });
        const swUrl = URL.createObjectURL(blob);
        navigator.serviceWorker
          .register(swUrl)
          .catch((err) => console.log("SW registration failed"));
      }

      // ==================== MANIFEST GENERATION ====================
      const manifestData = {
        name: "Productivity Dashboard",
        short_name: "ProdApp",
        start_url: window.location.pathname,
        display: "standalone",
        background_color: "#000814",
        theme_color: "#000814",
        icons: [
          {
            src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%2300ffc8'/%3E%3Ctext x='50%25' y='70' font-size='70' text-anchor='middle' fill='%23000814'%3EüöÄ%3C/text%3E%3C/svg%3E",
            sizes: "192x192",
            type: "image/svg+xml",
          },
          {
            src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%2300ffc8'/%3E%3Ctext x='50%25' y='70' font-size='70' text-anchor='middle' fill='%23000814'%3EüöÄ%3C/text%3E%3C/svg%3E",
            sizes: "512x512",
            type: "image/svg+xml",
          },
        ],
      };
      const manifestBlob = new Blob([JSON.stringify(manifestData)], {
        type: "application/json",
      });
      const manifestUrl = URL.createObjectURL(manifestBlob);
      const manifestLink = document.createElement("link");
      manifestLink.rel = "manifest";
      manifestLink.href = manifestUrl;
      document.head.appendChild(manifestLink);

      // ==================== QUOTE SYSTEM ====================
      const inspirationalQuotes = [
        { text: "Discipline is destiny.", author: "Ryan Holiday" },
        {
          text: "The secret of getting ahead is getting started.",
          author: "Mark Twain",
        },
        {
          text: "Success is not final, failure is not fatal.",
          author: "Winston Churchill",
        },
        {
          text: "The only way to do great work is to love what you do.",
          author: "Steve Jobs",
        },
        {
          text: "Don't watch the clock; do what it does. Keep going.",
          author: "Sam Levenson",
        },
        {
          text: "The future depends on what you do today.",
          author: "Mahatma Gandhi",
        },
        {
          text: "Believe you can and you're halfway there.",
          author: "Theodore Roosevelt",
        },
      ];

      async function fetchQuote() {
        try {
          const response = await fetch(
            "https://api.quotable.io/random?tags=success,inspirational"
          );
          const data = await response.json();
          document.getElementById(
            "quoteText"
          ).textContent = `"${data.content}"`;
          document.getElementById(
            "quoteAuthor"
          ).textContent = `‚Äî ${data.author}`;
        } catch (e) {
          const q =
            inspirationalQuotes[
              Math.floor(Math.random() * inspirationalQuotes.length)
            ];
          document.getElementById("quoteText").textContent = `"${q.text}"`;
          document.getElementById("quoteAuthor").textContent = `‚Äî ${q.author}`;
        }
      }
      fetchQuote();

      // ==================== TIME UPDATE ====================
      function updateTime() {
        const now = new Date();
        const timeEl = document.getElementById("currentTime");
        const dateEl = document.getElementById("currentDate");
        if (timeEl)
          timeEl.textContent = now.toLocaleTimeString("en-US", {
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          });
        if (dateEl)
          dateEl.textContent = now.toLocaleDateString("en-US", {
            weekday: "long",
            month: "long",
            day: "numeric",
          });
      }
      setInterval(updateTime, 1000);
      updateTime();

      // ==================== STATE MANAGEMENT ====================
      const defaultSchedule = [
        {
          id: 1,
          time: "6:30 AM - 7:10 AM",
          task: "Wake, hydrate, stretch, brisk walk",
          method: "Morning Dopamine Reset",
        },
        {
          id: 2,
          time: "7:10 AM - 7:40 AM",
          task: "Active recall / review notes",
          method: "Spaced Repetition",
        },
        {
          id: 3,
          time: "7:40 AM - 8:20 AM",
          task: "Ready + breakfast",
          method: "No Phone",
        },
        {
          id: 4,
          time: "8:20 AM - 8:30 AM",
          task: "Parent call / brief reflection",
          method: "Habit Stacking",
        },
        {
          id: 5,
          time: "8:30 AM - 4:45 PM",
          task: "College",
          method: "Manual Notes + Highlight",
        },
        {
          id: 6,
          time: "4:50 PM - 5:15 PM",
          task: "Tiffin + rest",
          method: "Screen-Free Recharge",
        },
        {
          id: 7,
          time: "5:15 PM - 7:15 PM",
          task: "Assignments + core subject study",
          method: "2 x Pomodoro (50/10)",
        },
        {
          id: 8,
          time: "7:15 PM - 8:30 PM",
          task: "Dinner + talk + parent call",
          method: "Relax",
        },
        {
          id: 9,
          time: "8:30 PM - 10:00 PM",
          task: "Python (CodeWithHarry)",
          method: "Watch + Implement",
        },
        {
          id: 10,
          time: "10:00 PM - 10:20 PM",
          task: "Read Atomic Habits",
          method: "Reflection Journaling",
        },
        {
          id: 11,
          time: "10:20 PM - 10:45 PM",
          task: "Plan tomorrow + wind down",
          method: "No Screens",
        },
      ];

      const state = {
        tasks: [],
        habitChecks: {},
        habits: [
          "Morning Stretch",
          "Active Recall",
          "No Phone Before 3PM",
          "Python Study",
          "Read Atomic Habits",
        ],
        schedule: JSON.parse(JSON.stringify(defaultSchedule)),
        target: "8.5+ CGPA",
        pomodoroTime: 25 * 60,
        pomodoroActive: false,
        pomodoroMode: "work",
        customAlarmFile: null,
      };

      const days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];

      // ==================== NAVIGATION ====================
      window.switchSection = function (sectionId, element) {
        document
          .querySelectorAll(".nav-btn-wrapper")
          .forEach((b) => b.classList.remove("active"));
        element.classList.add("active");
        document
          .querySelectorAll(".section")
          .forEach((s) => s.classList.remove("active"));
        const section = document.getElementById(sectionId);
        if (section) section.classList.add("active");
      };

      // ==================== TARGET MANAGEMENT ====================
      window.updateTarget = async function () {
        const input = document.getElementById("customTarget");
        if (input && input.value.trim()) {
          state.target = input.value.trim();
          const targetDisplay = document.getElementById("targetDisplay");
          const goalTitle = document.getElementById("goalTitle");
          if (targetDisplay)
            targetDisplay.innerHTML = `üéØ Target: ${state.target}`;
          if (goalTitle) goalTitle.innerHTML = `üéØ ${state.target}`;
          await saveToDatabase("target", state.target);
          alert("‚úÖ Target updated successfully!");
        }
      };

      // ==================== SCHEDULE SORTING & RENDERING ====================
      function parseTimeValue(timeStr) {
        const match = timeStr.match(/(\d{1,2}):(\d{2})\s*(AM|PM|am|pm)?/i);
        if (!match) return 0;
        let hours = parseInt(match[1]);
        const mins = parseInt(match[2]);
        const period = (match[3] || "").toUpperCase();
        if (period === "PM" && hours !== 12) hours += 12;
        if (period === "AM" && hours === 12) hours = 0;
        return hours * 100 + mins;
      }

      function sortSchedules() {
        state.schedule.sort(
          (a, b) => parseTimeValue(a.time) - parseTimeValue(b.time)
        );
      }

      function renderSchedule() {
        const container = document.getElementById("scheduleContainer");
        if (!container) return;
        sortSchedules();
        container.innerHTML = state.schedule
          .map(
            (item) => `
                <div class="schedule-card">
                    <div class="time-badge">${item.time}</div>
                    <h3 style="color: #e0e0e0; font-weight: 600; margin-bottom: 0.5rem; font-size: 1.125rem;">${item.task}</h3>
                    <p style="color: #00ffc8; font-size: 0.875rem; text-transform: uppercase;">${item.method}</p>
                </div>
            `
          )
          .join("");
      }

      function renderScheduleEditor() {
        const container = document.getElementById("scheduleEditor");
        if (!container) return;
        sortSchedules();
        container.innerHTML = state.schedule
          .map(
            (item) => `
                <div style="background: rgba(10, 26, 46, 0.4); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1rem; border: 1px solid rgba(0, 255, 200, 0.2); display: flex; justify-content: space-between; align-items: start;">
                    <div style="flex: 1;">
                        <div style="color: #00ffc8; font-weight: bold; margin-bottom: 0.5rem;">‚è∞ ${item.time}</div>
                        <div style="color: #e0e0e0; font-size: 1.125rem; font-weight: 600; margin-bottom: 0.25rem;">${item.task}</div>
                        <div style="color: #a855f7; font-size: 0.875rem;">${item.method}</div>
                    </div>
                    <button onclick="deleteScheduleItem(${item.id})" class="btn-danger" style="margin-left: 1rem;">üóëÔ∏è</button>
                </div>
            `
          )
          .join("");
      }

      window.addScheduleItem = async function () {
        const timeInput = document.getElementById("newScheduleTime");
        const taskInput = document.getElementById("newScheduleTask");
        const methodInput = document.getElementById("newScheduleMethod");

        if (
          timeInput &&
          taskInput &&
          methodInput &&
          timeInput.value.trim() &&
          taskInput.value.trim() &&
          methodInput.value.trim()
        ) {
          const newId =
            Math.max(...state.schedule.map((s) => s.id || 0), 0) + 1;
          state.schedule.push({
            id: newId,
            time: timeInput.value.trim(),
            task: taskInput.value.trim(),
            method: methodInput.value.trim(),
          });
          renderSchedule();
          renderScheduleEditor();
          await saveToDatabase("schedule", state.schedule);
          timeInput.value = "";
          taskInput.value = "";
          methodInput.value = "";
          alert("‚úÖ Schedule item added!");
        }
      };

      window.deleteScheduleItem = async function (id) {
        if (confirm("Delete this schedule item?")) {
          state.schedule = state.schedule.filter((s) => s.id !== id);
          renderSchedule();
          renderScheduleEditor();
          await saveToDatabase("schedule", state.schedule);
        }
      };

      // ==================== RESET & EXPORT ====================
      window.resetToDefaults = async function () {
        if (confirm("Reset all customizations to defaults?")) {
          state.schedule = JSON.parse(JSON.stringify(defaultSchedule));
          state.target = "8.5+ CGPA";
          document.getElementById("customTarget").value = state.target;
          renderSchedule();
          renderScheduleEditor();
          updateTarget();
          await saveToDatabase("schedule", state.schedule);
          alert("‚úÖ Reset complete!");
        }
      };

      window.exportData = function () {
        const data = {
          tasks: state.tasks,
          habits: state.habits,
          habitChecks: state.habitChecks,
          schedule: state.schedule,
          target: state.target,
          exportDate: new Date().toISOString(),
        };
        const jsonStr = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `productivity-dashboard-${
          new Date().toISOString().split("T")[0]
        }.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        alert("‚úÖ Data exported successfully!");
      };

      // ==================== POMODORO TIMER ====================
      let pomodoroInterval;
      function formatTime(s) {
        return `${Math.floor(s / 60)
          .toString()
          .padStart(2, "0")}:${(s % 60).toString().padStart(2, "0")}`;
      }

      function updatePomodoro() {
        const el = document.getElementById("pomodoroDisplay");
        if (el) el.textContent = formatTime(state.pomodoroTime);
      }

      function playAlarm() {
        if (state.customAlarmFile) {
          const audio = new Audio(state.customAlarmFile);
          audio.play().catch((e) => console.log("Audio play failed"));
        } else {
          try {
            const ctx = new (window.AudioContext ||
              window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.value = 800;
            gain.gain.setValueAtTime(0.3, ctx.currentTime);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.5);
          } catch (e) {
            console.log("Audio context failed");
          }
        }
      }

      window.togglePomodoro = function () {
        if (state.pomodoroActive) {
          clearInterval(pomodoroInterval);
          state.pomodoroActive = false;
          document.getElementById("startBtn").innerHTML = "‚ñ∂Ô∏è Start";
        } else {
          state.pomodoroActive = true;
          document.getElementById("startBtn").innerHTML = "‚è∏Ô∏è Pause";
          pomodoroInterval = setInterval(() => {
            state.pomodoroTime--;
            updatePomodoro();
            if (state.pomodoroTime <= 0) {
              clearInterval(pomodoroInterval);
              state.pomodoroActive = false;
              playAlarm();

              if (state.pomodoroMode === "work") {
                alert("‚úÖ Work session completed! Time for a break.");
                state.pomodoroMode = "break";
                state.pomodoroTime = 5 * 60;
              } else {
                alert("‚òï Break finished! Ready for another session?");
                state.pomodoroMode = "work";
                state.pomodoroTime = 25 * 60;
              }
              document.getElementById("startBtn").innerHTML = "‚ñ∂Ô∏è Start";
              updatePomodoro();
            }
          }, 1000);
        }
      };

      window.resetPomodoro = function () {
        clearInterval(pomodoroInterval);
        state.pomodoroActive = false;
        state.pomodoroTime = state.pomodoroMode === "work" ? 25 * 60 : 5 * 60;
        updatePomodoro();
        document.getElementById("startBtn").innerHTML = "‚ñ∂Ô∏è Start";
      };

      window.setWork = function () {
        state.pomodoroMode = "work";
        resetPomodoro();
      };

      window.setBreak = function () {
        state.pomodoroMode = "break";
        resetPomodoro();
      };

      const alarmInput = document.getElementById("customAlarm");
      if (alarmInput) {
        alarmInput.addEventListener("change", (e) => {
          const file = e.target.files[0];
          if (file) {
            state.customAlarmFile = URL.createObjectURL(file);
            const status = document.getElementById("alarmStatus");
            if (status) status.style.display = "block";
          }
        });
      }

      // ==================== HABIT MANAGEMENT ====================
      function renderHabits() {
        const container = document.getElementById("habitsContainer");
        if (!container) return;
        container.innerHTML = state.habits
          .map(
            (habit) => `
                <div class="glass-card-wrapper">
                    <div class="card-glow"></div>
                    <div class="glass-card">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                            <h3 style="font-size: 1.25rem; color: #e0e0e0; font-weight: bold;">${habit}</h3>
                            <button onclick="deleteHabit('${habit.replace(
                              /'/g,
                              "\\'"
                            )}'))" class="btn-danger">üóëÔ∏è</button>
                        </div>
                        <div class="grid-7">
                            ${days
                              .map((day) => {
                                const key = `${habit}-${day}`;
                                const checked = state.habitChecks[key] || false;
                                return `
                                    <div class="habit-day ${
                                      checked ? "checked" : ""
                                    }" onclick="toggleHabit('${habit.replace(
                                  /'/g,
                                  "\\'"
                                )}', '${day}')">
                                        <div style="font-size: 0.75rem; font-weight: 600;">${day}</div>
                                        ${
                                          checked
                                            ? '<div style="font-size: 1.5rem; margin-top: 0.25rem;">‚úì</div>'
                                            : ""
                                        }
                                    </div>
                                `;
                              })
                              .join("")}
                        </div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      window.toggleHabit = async function (habit, day) {
        const key = `${habit}-${day}`;
        state.habitChecks[key] = !state.habitChecks[key];
        renderHabits();
        updateStats();
        await saveToDatabase("habitChecks", state.habitChecks);
      };

      window.deleteHabit = async function (habit) {
        if (confirm(`Delete habit "${habit}"?`)) {
          state.habits = state.habits.filter((h) => h !== habit);
          renderHabits();
          updateStats();
          await saveToDatabase("habits", state.habits);
        }
      };

      window.addHabit = async function () {
        const input = document.getElementById("newHabitInput");
        if (input && input.value.trim()) {
          state.habits.push(input.value.trim());
          input.value = "";
          renderHabits();
          updateStats();
          await saveToDatabase("habits", state.habits);
        }
      };

      // ==================== TASK MANAGEMENT ====================
      window.addTask = async function () {
        const input = document.getElementById("newTaskInput");
        if (input && input.value.trim()) {
          state.tasks.push({
            id: Date.now(),
            text: input.value.trim(),
            completed: false,
          });
          input.value = "";
          renderAllTasks();
          updateStats();
          await saveToDatabase("tasks", state.tasks);
        }
      };

      window.toggleTask = async function (id) {
        const task = state.tasks.find((t) => t.id === id);
        if (task) {
          task.completed = !task.completed;
          renderAllTasks();
          updateStats();
          await saveToDatabase("tasks", state.tasks);
        }
      };

      window.deleteTask = async function (id) {
        if (confirm("Delete this task?")) {
          state.tasks = state.tasks.filter((t) => t.id !== id);
          renderAllTasks();
          updateStats();
          await saveToDatabase("tasks", state.tasks);
        }
      };

      function renderAllTasks() {
        const container = document.getElementById("allTasks");
        if (!container) return;
        container.innerHTML =
          state.tasks.length > 0
            ? state.tasks
                .map(
                  (task) => `
                <div style="display: flex; align-items: center; justify-content: space-between; background: linear-gradient(135deg, rgba(10, 26, 46, 0.5), rgba(15, 30, 55, 0.5)); border-radius: 1rem; padding: 1rem; margin-bottom: 0.75rem; border: 1px solid rgba(0, 255, 200, 0.2); transition: all 0.3s;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <input type="checkbox" ${
                          task.completed ? "checked" : ""
                        } onchange="toggleTask(${task.id})">
                        <span style="color: #e0e0e0; ${
                          task.completed
                            ? "text-decoration: line-through; opacity: 0.5;"
                            : ""
                        }">${task.text}</span>
                    </div>
                    <button onclick="deleteTask(${
                      task.id
                    })" class="btn-danger">üóëÔ∏è</button>
                </div>
            `
                )
                .join("")
            : '<p style="color: #94a3b8; text-align: center; font-style: italic; padding: 2rem;">No tasks yet - add your first one!</p>';
      }

      function renderActiveTasks() {
        const container = document.getElementById("activeTasks");
        if (!container) return;
        const active = state.tasks.filter((t) => !t.completed).slice(0, 5);
        container.innerHTML =
          active.length > 0
            ? active
                .map(
                  (task) => `
                <div style="display: flex; align-items: center; gap: 1rem; background: linear-gradient(135deg, rgba(10, 26, 46, 0.5), rgba(15, 30, 55, 0.5)); border-radius: 1rem; padding: 1rem; margin-bottom: 0.75rem; border: 1px solid rgba(0, 255, 200, 0.2); transition: all 0.3s;">
                    <input type="checkbox" onchange="toggleTask(${task.id})">
                    <span style="color: #e0e0e0;">${task.text}</span>
                </div>
            `
                )
                .join("")
            : '<p style="color: #94a3b8; text-align: center; font-style: italic; padding: 2rem;">No active tasks!</p>';
      }

      // ==================== STATISTICS ====================
      function updateStats() {
        const total = state.tasks.length;
        const completed = state.tasks.filter((t) => t.completed).length;
        const pending = total - completed;
        const habits = Object.values(state.habitChecks).filter(Boolean).length;
        const progress = total > 0 ? Math.round((completed / total) * 100) : 0;

        const updates = {
          taskCount: pending,
          doneCount: completed,
          habitCount: habits,
          progressPercent: progress + "%",
          completionRate: progress + "%",
          pendingTasks: pending,
          completedTasks: completed,
          cgpaProgress: progress + "%",
        };

        Object.entries(updates).forEach(([id, value]) => {
          const el = document.getElementById(id);
          if (el) el.textContent = value;
        });

        const cgpaBar = document.getElementById("cgpaBar");
        if (cgpaBar) cgpaBar.style.width = progress + "%";

        renderActiveTasks();
        renderHabitStreaks();
      }

      function renderHabitStreaks() {
        const container = document.getElementById("habitStreaks");
        if (!container) return;
        container.innerHTML = state.habits
          .map((habit) => {
            const completed = days.filter(
              (day) => state.habitChecks[`${habit}-${day}`]
            ).length;
            const pct = (completed / 7) * 100;
            return `
                    <div style="margin-bottom: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: #e0e0e0; font-weight: 600; font-size: 1.125rem;">${habit}</span>
                            <span style="color: #00ffc8; font-weight: bold; font-size: 1.125rem;">${completed}/7 days</span>
                        </div>
                        <div style="height: 1rem; background: linear-gradient(135deg, #1e293b, #0f172a); border-radius: 9999px; overflow: hidden; border: 1px solid rgba(0, 255, 200, 0.3);">
                            <div style="height: 100%; background: linear-gradient(90deg, #00ffc8, #a855f7); width: ${pct}%; transition: width 0.5s; box-shadow: 0 0 20px rgba(0, 255, 200, 0.8);"></div>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function renderAll() {
        renderSchedule();
        renderScheduleEditor();
        renderHabits();
        renderAllTasks();

        const targetDisplay = document.getElementById("targetDisplay");
        const goalTitle = document.getElementById("goalTitle");
        const customTargetInput = document.getElementById("customTarget");

        if (targetDisplay)
          targetDisplay.innerHTML = `üéØ Target: ${state.target}`;
        if (goalTitle) goalTitle.innerHTML = `üéØ ${state.target}`;
        if (customTargetInput) customTargetInput.value = state.target;
      }

      // ==================== LOAD FIREBASE CONFIG ON PAGE LOAD ====================
      const savedApiKey = localStorage.getItem("firebase_apiKey");
      const savedProjectId = localStorage.getItem("firebase_projectId");
      const savedAppId = localStorage.getItem("firebase_appId");

      if (savedApiKey && savedProjectId && savedAppId) {
        const apiKeyInput = document.getElementById("firebaseApiKey");
        const projectIdInput = document.getElementById("firebaseProjectId");
        const appIdInput = document.getElementById("firebaseAppId");

        if (apiKeyInput) apiKeyInput.value = savedApiKey;
        if (projectIdInput) projectIdInput.value = savedProjectId;
        if (appIdInput) appIdInput.value = savedAppId;

        initFirebase();
      } else {
        // Load from localStorage if no Firebase config
        loadFromDatabase();
      }

      // ==================== INITIALIZE ====================
      renderAll();
      updateStats();
      updatePomodoro();
    </script>
  </body>
</html>
